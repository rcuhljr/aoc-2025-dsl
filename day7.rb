sample = <<'DATA'
.......S.......
...............
.......^.......
...............
......^.^......
...............
.....^.^.^.....
...............
....^.^...^....
...............
...^.^...^.^...
...............
..^...^.....^..
...............
.^.^.^.^.^...^.
...............
DATA

actual = <<'DATA'
......................................................................S......................................................................
.............................................................................................................................................
......................................................................^......................................................................
.............................................................................................................................................
.....................................................................^.^.....................................................................
.............................................................................................................................................
....................................................................^.^.^....................................................................
.............................................................................................................................................
...................................................................^...^.^...................................................................
.............................................................................................................................................
..................................................................^.^.....^..................................................................
.............................................................................................................................................
.................................................................^...^.^.^.^.................................................................
.............................................................................................................................................
................................................................^...^.^.....^................................................................
.............................................................................................................................................
...............................................................^.^.^.^...^...^...............................................................
.............................................................................................................................................
..............................................................^.^.^.^.^.^.^.^.^..............................................................
.............................................................................................................................................
.............................................................^.....^.^.^.^.^...^.............................................................
.............................................................................................................................................
............................................................^.^.^...^.....^.^...^............................................................
.............................................................................................................................................
...........................................................^.^.^.^.^.^.^.^.^.^.^.^...........................................................
.............................................................................................................................................
..........................................................^...^...^...^.^.^.^...^.^..........................................................
.............................................................................................................................................
.........................................................^.^...^...^.^.^.^...^...^.^.........................................................
.............................................................................................................................................
........................................................^.^...^.^.^...^.^...^.^.^...^........................................................
.............................................................................................................................................
.......................................................^...^.^.......^.^.^.......^.^.^.......................................................
.............................................................................................................................................
......................................................^.^.^...^.^.....^.^...^.....^.^.^......................................................
.............................................................................................................................................
.....................................................^.^.^...^.^...^.^.^.^.^...^.^.....^.....................................................
.............................................................................................................................................
....................................................^.^.^.^...^...^.^.^.^.^.^...........^....................................................
.............................................................................................................................................
...................................................^...^.^.^.^.^.^.^.....^.^.^.........^.^...................................................
.............................................................................................................................................
..................................................^.^.^.^.^.^.^.^.^.^.^.^...^...^.^.^...^.^..................................................
.............................................................................................................................................
.................................................^...^.^...^.^.^.....^.^.^.........^.....^.^.................................................
.............................................................................................................................................
................................................^.......^...^.^.^.^.....^.....^.^...^...^.^.^................................................
.............................................................................................................................................
...............................................^.^.^.^.^.^.....^.^.^.^...^.^.^...^.^.^.^.^...^...............................................
.............................................................................................................................................
..............................................^...^.....^.......^.^...^...^.^.....^.^...^...^.^..............................................
.............................................................................................................................................
.............................................^.^.^.^...^.^.^.....^.^...^.^.^...^.....^.^.^.....^.............................................
.............................................................................................................................................
............................................^.^.....^.^...^...^.^...^.^.^.....^.^.^.^.^.^.^.^.^.^............................................
.............................................................................................................................................
...........................................^...^.^.^...^...^.^.^.^.^...^.....^.^.........^.^.^.^.^...........................................
.............................................................................................................................................
..........................................^...^.^.^.^.......^.^.^...^...^...^.^.^.^.....^.^.^...^.^..........................................
.............................................................................................................................................
.........................................^.^.^.^.^...^.^.^.^.^.^.^...^.^.^.....^.^.^...^.^.^.^.^...^.........................................
.............................................................................................................................................
........................................^.^.^.^.^...^...^...^...^.^.....^.......^.^...^...^.^.^.^.^.^........................................
.............................................................................................................................................
.......................................^...^...^...^.^...^.^...^.^.^...^.^.^.^.^.^...^.^.^.^.^.^.^...^.......................................
.............................................................................................................................................
......................................^.^.^.....^.^.^...^.^.^.^...^.^.^.^...^...^.^.^.^.........^.^.^.^......................................
.............................................................................................................................................
.....................................^.^...^...^.^.^...^.^.^.^.....^.^...^.^.^.^.^.......^...^.^...^.^.^.....................................
.............................................................................................................................................
....................................^.^.^.^.^.^.^.^.^.^...^.....^.^.^.^...^.^.^...^.^.^.^.^...^.^.^.^.^.^....................................
.............................................................................................................................................
...................................^.....^.^.......^...^.^.....^.^.^.^...^.....^.^.^.^.^...^...^...^...^.^...................................
.............................................................................................................................................
..................................^.^.^.^...^.^.....^.^...^.^.......^...^...^.....^.^.^.^.....^.^.^.^.^.^.^..................................
.............................................................................................................................................
.................................^...^.....^.^.^.^.^.^.....^...^...^.^...^.^.^...^.^.^.^.^.^.^.^.^.....^...^.................................
.............................................................................................................................................
................................^.^.......^.^.....^.^.^.....^.^...^...^.^.^.^...^.....^...^.^.^.^...^.^...^.^................................
.............................................................................................................................................
...............................^.^...^.^...^.......^...^.^.^.^.^.^.^.^.^...^.^.^.^.........^.^.^...^.^.^.^.^.^...............................
.............................................................................................................................................
..............................^.^.^.^...^.^...^.^.......^.....^.^.^.^.^.^...^.......^.^.^.^.^.^.^.^.^.......^.^..............................
.............................................................................................................................................
.............................^...^.....^.^.^.^.....^.^.^...^.^.^...^.......^.^.^.^.^.^.^.......^...^...^.^...^.^.............................
.............................................................................................................................................
............................^.^...^.^...^.^.^.^.^...^.^.......^.^.^.^.........^.^.^.........^.^.....^.^.^.^.^.^.^............................
.............................................................................................................................................
...........................^.^.^.^.^.^.^.^...^.^...^.^...^.^.^.....^.^.......^.....^.^.^.^...^.^.^.^.^.^.^...^.^.^...........................
.............................................................................................................................................
..........................^.^...^...^.^.^...^...^...^...^.....^.^...^.^.^.^.^...^.^...^.^.^.....^.^...^.^...^.^.^.^..........................
.............................................................................................................................................
.........................^.^.^.^.^.^.^.^.^.^.^.....^.^.......^...^.............^.^.^.^.^.......^.^.^.^.^.^.^.^...^.^.........................
.............................................................................................................................................
........................^.^.^.^...^...^.^.^.^.^.^.^.^.^.....^.^.........^.^.^.^.^.^.^.^.....^...^...^.^.^.^.^.^.^.^.^........................
.............................................................................................................................................
.......................^.^...^.^.....^.^.^...^...^...^.^...^.^.^.^.^.^.^.......^.^.^...^.^.^.....^.^...^...^.........^.......................
.............................................................................................................................................
......................^...^.^...^.....^...^.^.^.......^.^.^.^.^...^.^.^.^.^.^.^...^...^.........^.^.^...^.^...^.^.^...^......................
.............................................................................................................................................
.....................^.....^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.^...^.^.^.^.^.....^...^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.....................
.............................................................................................................................................
....................^.^.^.^...^.^.^.........^.^...^.^...^.^...^.^.^.....^.^.^.^.....^...^.^...^.^.^.....^...^.^.^.^.^.^.^....................
.............................................................................................................................................
...................^.^.^...^...^.^.^.^...^.^.^.^.^.^.^.^.^...^.^.^...^.^.^.^.^.^.^...^.^...^.^.^.^.^.^.^.^.^.^.^.........^...................
.............................................................................................................................................
..................^.^.^.^...^.....^...^...^.^.^.^.....^.^...^.^.^.^.^.^.^.^.^.......^.^.........^.....^.^.^.^.^.....^.^.^.^..................
.............................................................................................................................................
.................^.^.....^.....^.^.^.^...^...^.^.^.^...^.......^.^...^.^...^.^...^.........^...^.^.^.....^...^...^.^.....^.^.................
.............................................................................................................................................
................^.^...^.^.....^.^.^.^.^.^...^.^...^...^.......^.........^.^.^.^.^.^...........^...^.^.^.^.^.^...^...^.^.^...^................
.............................................................................................................................................
...............^.....^...^.^.^.........^.^.^.^.^.^.^.^...^.^.^...^...^.^...^.^.....^.^.....^...^.....^...^.^.....^.^.^.^...^.^...............
.............................................................................................................................................
..............^.^...^.^.^...^.......^.^.^.^...^...^.....^.^.^.^.^.^.^.^...^.^.^.^.^.^...^.^.^...^.^.^.^.^...^.^.^.^.^.....^...^..............
.............................................................................................................................................
.............^.^.^...^.^.^.^...^.^...^...^.^.^.^.....^...^.^.^.^.........^.^...^.^.^.........^...^...^...^.^.^.^.^.^.^.......^.^.............
.............................................................................................................................................
............^.^.^.^.^...^.^.^...^...^...^.^.^.^.^...^.^.^.^.^...^...^.....^.^.^.^.^...^...^...^.......^...^.^.^...^.^.^.^...^.^.^............
.............................................................................................................................................
...........^...^.....^...^.^.^.^.^.^.^.^.......^.......^...^.^.^.^.^...^.^...^.....^.^.......^.^...^.....^...^.^...^...^.....^.^.^...........
.............................................................................................................................................
..........^.^...^.^.^...^.............^.^.^.^.^.^.^...^.^.^.^.............^.^.^.^.^.^.^.^.......^.^.^.^...^.^.^.^.^...^.^.^.^.^...^..........
.............................................................................................................................................
.........^.....^...^.^.^.....^.^.^.^...^.^...^...^.^.^.^.^.^.^.....^.......^.^.^...^...^.^.^...^.^.^.....^.....^.^.^.^.^.....^.....^.........
.............................................................................................................................................
........^.^.^.^.^.^...^.....^.^...^.^.^.^.^.^.^.^.....^.^.^.^.^.......^...^...^.^...^...^.^.^.^.^.^.^.^.^.^.^...^.....^.^.^.....^...^........
.............................................................................................................................................
.......^.^.....^...^.....^.^.....^...^.^.....^...^.^...^.^.^.^.^.....^...^.^.^.^.....^.^...^.^...^.^.^.^...^.^.^.....^...^...^...^...^.......
.............................................................................................................................................
......^.^...^.^.^.....^.....^...^...^...^.^...^.^.^.^.............^...^.^...^.....^...^.^.^...^.^.^...^.^.^...^...^.^.^.^.......^.....^......
.............................................................................................................................................
.....^.^.^.^...^.^.^.^.^.^...^...^.^.^.^.....^.^.^.^.^.....^.^.^.^...^.^.^...^.^.^...^...^.....^.^.^.^.......^...^.^.^...^.^...^.^.^.^.^.....
.............................................................................................................................................
....^.^.^.^...^.^.^.^...^.^...^.^.^.^.......^.^.^.^.^.^.^...^.^...^.^.^.^.^...^.^.....^.^.^...^.^.^.^.^.^.^...^.....^.^.....^.^.^.^.^.^.^....
.............................................................................................................................................
...^.^.^.^.^.......^.^.^.^.^...^...^.^...^.^.......^.^...^.......^...........^.^.^.....^...^.^.^.^...^.........^.^...^...^.^.^.....^.^.^.^...
.............................................................................................................................................
..^.......^.^.^.^.^...^.^...^.^.^.^.^.^.....^.^.......^.^...^.^.^.^.^...^.^.^.^.....^.^.^.....^...^.^.....^...^.^.^.^.^.^.^...^.....^.^...^..
.............................................................................................................................................
.^.^.........^.^.^.^...^...^.^...^.^...^.^...^.^.^...^.^.......^...^.....^.^.^.^.^...^.^.^.^.^.^...^.^...^.^...^.^.^.^.^...^.^.^.^.^...^.^.^.
.............................................................................................................................................
DATA

def check_space(grid, x, y)
  return 0 if y == 0
  if grid[y-1][x] == 'S' || grid[y-1][x] == '|' #beam above you
    if grid[y][x] == '^'
      grid[y][x-1] = '|'
      grid[y][x+1] = '|'
      return 1
    else
      grid[y][x] = '|'
    end
  end
  0
end


def solveA(input)
  layout = input.split().map{|row| row.each_char.to_a }
  count = 0
  (0..layout.size-1).each do |y|
    next if y == 0
    (0..layout[0].size-1).each do |x|
      count += check_space(layout, x, y)
    end
  end
  count
end

def check_space_b(grid, x, y)
  if grid[y-1][x] == 'S' || grid[y-1][x].is_a?(Integer) #beam above you
    source_val = grid[y-1][x]
    source_val = source_val.is_a?(Integer) ? source_val : 1
    if grid[y][x] == '^'
      grid[y][x-1] = grid[y][x-1].to_i + source_val
      grid[y][x+1] = grid[y][x+1].to_i + source_val
    else
      grid[y][x] = grid[y][x].to_i + source_val
    end
  end
end

def solveB(input)
  layout = input.gsub('.','0').split().map{|row| row.each_char.to_a }
  (0..layout.size-1).each do |y|
    next if y == 0
    (0..layout[0].size-1).each do |x|
      check_space_b(layout, x, y)
    end
  end

  layout.last.keep_if{|x| x.is_a?(Integer)}.sum
end




puts solveA(sample)
puts solveA(actual)


puts solveB(sample)
puts solveB(actual)